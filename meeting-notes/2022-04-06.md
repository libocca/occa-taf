# 2022-04-06

## Meeting Link

*This will be posted ~15 mins prior to the start of the meeting.*

## Attendees

- 

## Follow-up
*Action items from last meeting*

- [x] Create structure on GitHub for contributing to the documentation efforts
- [ ] Find volunteers to lead the efforts in various aspects of user documentation

## Agenda

1. Brief update on documentation efforts.
2. Compilation  
   - User requirements  
     - Large parallel filesystems
     - Deploying precompiled kernels
   - AOT Compilation
   - JIT Compilation


## Notes

### Update on Documentation Efforts

- New issues have been added on GitHub to cover documentation efforts discussed previously
- More volunteers are needed to take on specific areas

### Compilation

#### User Requirements

1. Large Parallel Filesystems
   - [NekRS](https://github.com/Nek5000/nekRS/blob/master/src/core/platform.cpp)
2. Deploying precompiled kernels

#### Ahead-of-time Compilation

- Currently this can be done through the OCCA commandline tool
  - Somewhat cumbersome to use
- *Proposals*: 
  1. Implement a shell script or separate commandline tool, `occacxx`&mdash;similar to `mpicxx`
  2. Implement functionality to link kernels into a single module/dll
     - Reduce filesystem stress at runtime, potentially side-step LPFS issues
     - Complements the kernel bundles proposal below
  3. Create CMake scripts to integrate `occacxx` into application build systems

#### JIT Compilation

- *Proposals*  
  1. Kernel Bundles&mdash;e.g., see
     - [SYCL 2020 spec](https://www.khronos.org/registry/SYCL/specs/sycl-2020/html/sycl-2020.html#sec:interfaces.bundles)
     - [OpenCL 3.0 spec](https://www.khronos.org/registry/OpenCL/specs/3.0-unified/html/OpenCL_API.html#_program_objects)
  2. Support for asynchronous jitting
     - Use [C++ concurrency support library](https://en.cppreference.com/w/cpp/thread)
     - See [this draft PR](https://github.com/libocca/occa/pull/571) for an example.
  3. File Abstraction to allow for plugin implementation
     - Default to using [C++17 filesystem library](https://en.cppreference.com/w/cpp/filesystem)
     - Implement an optional plugin for parallel filesytems using MPI-IO
  4. API for MPI aware JIT&mdash;*thanks to Stefan K. for suggestion*
      ```
      buildKernelMPI(const string& fileName, const string& kernelName, const json& props, int root, const MPI_Comm& comm)
      ```
     - Goals  
       - Scaleable and lock-free
       - Cache generated binaries to accelerate build process
     - Example Implementation
       - Build on root; fsync all build artifacts to ensure durability
       - Broadcast build files to all compute nodes
       - Node local root writes to `$TMPDIR`, calls fsync
       - Load kernel binary from `$TMPDIR` on all ranks 
     - Caveats
       - Introduces a new&mdash;but optional&mdash;dependency on MPI (during initial OCCA build)
       - Device driver may cache binaries internally (turn off)
       - Using `system` to invoke the compiler is non-portable, however not all backends provide a runtime options (e.g. serial)  

## Action Items

- [ ]

## Next Meeting

- [2022-04-20](2022-04-20.md)
- OpenMP backend
